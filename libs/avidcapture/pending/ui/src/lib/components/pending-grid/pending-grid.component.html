<xdc-context-menu
  class="context-menu"
  [style.left.px]="contextMenuPosition.left"
  [style.top.px]="contextMenuPosition.top"
  (unlockDocumentEvent)="unlockDocumentEvent.emit(unlockDocument)"
  [showContextMenu]="contextMenuVisible"
  (hideContextMenuEvent)="contextMenuVisible=!$event"
></xdc-context-menu>

<ax-table
  *ngIf="documents.length > 0"
  tableType="default"
  size="relaxed"
  [displayedColumns]="displayedColumns"
  [dataSource]="documentDataSource"
  [allowSort]="true"
  [customTemplate]="true"
  [customSort]="false"
  [virtualScroll]="false"
  [fixedColumns]="true"
  [matSortActive]="'dateReceived'"
  [matSortDirection]="'asc'"
  (matSortChange)="columnSorted.emit($event)"
  matSort
>
  <ng-container matColumnDef="checkbox">
    <th mat-header-cell *matHeaderCellDef>
      <ax-checkbox
        [noText]="true"
        [checked]="selection.hasValue() && isAllSelected()"
        [indeterminate]="selection.hasValue() && !isAllSelected()"
        (change)="$event ? selectAllRows() : null"
      >
      </ax-checkbox>
    </th>
    <td mat-cell *matCellDef="let row">
      <ax-checkbox
        [noText]="true"
        [checked]="selection.isSelected(row)"
        [disabled]="row.lockedBy !== 'none' && row.lockedBy !== currentUsername"
        (change)="selectRow(row)"
      >
      </ax-checkbox>
    </td>
  </ng-container>
  <ng-container *ngIf="!batchSelectIsActive" matColumnDef="lockedBy">
    <th mat-header-cell *matHeaderCellDef><mat-icon>lock</mat-icon></th>
    <td mat-cell *matCellDef="let row">
      <ng-template [ngIf]="row.lockedBy !== 'none'">
        <mat-icon
          (contextmenu)="canUnlockDocumentManually?onRightClick($event,row):null"
          [axTooltip]="row.lockedBy"
          [axTooltipStyle]="'primary'"
          [axTooltipPosition]="'above'"
          [axTooltipPointerPosition]="'center'"
          >lock</mat-icon
        >
      </ng-template>
    </td>
  </ng-container>
  <ng-container matColumnDef="fileName">
    <th mat-header-cell *matHeaderCellDef mat-sort-header="fileName">File name</th>
    <td mat-cell *matCellDef="let row">
      <ax-link *ngIf="row.lockedBy === 'none' || row.lockedBy === currentUsername" [size]="'lg'"
        ><a class="cursor" (click)="openInvoiceEvent.emit(row)">{{ row.fileName }}</a></ax-link
      >
      <ng-template [ngIf]="row.lockedBy !== 'none' && row.lockedBy !== currentUsername"
        >{{ row.fileName }}</ng-template
      >
    </td>
  </ng-container>
  <ng-container matColumnDef="sourceEmail">
    <th mat-header-cell *matHeaderCellDef mat-sort-header="sourceEmail">Sender email</th>
    <td mat-cell *matCellDef="let row">
      <ng-template [ngIf]="row.sourceEmail !== 'none'"> {{ row.sourceEmail }} </ng-template>
    </td>
  </ng-container>
  <ng-template [ngIf]="canViewAllBuyers">
    <ng-container matColumnDef="buyerName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="buyerName">Customer</th>
      <td mat-cell *matCellDef="let row">{{ row.buyerName }}</td>
    </ng-container>
  </ng-template>
  <ng-container matColumnDef="dateReceived">
    <th mat-header-cell *matHeaderCellDef mat-sort-header="dateReceived">Delivery date</th>
    <td mat-cell *matCellDef="let row">{{ row.dateReceived | dateMilli:'LL/dd/yy hh:mma' }}</td>
  </ng-container>
  <ng-container matColumnDef="ingestionType">
    <th mat-header-cell *matHeaderCellDef mat-sort-header="ingestionType">Delivery method</th>
    <td mat-cell *matCellDef="let row">{{ row.ingestionType | uppercaseWord }}</td>
  </ng-container>
  <ng-container *ngIf="batchSelectIsActive" matColumnDef="lockedBy">
    <th mat-header-cell *matHeaderCellDef><mat-icon>lock</mat-icon></th>
    <td mat-cell *matCellDef="let row">
      <ng-template [ngIf]="row.lockedBy !== 'none'">
        <mat-icon
          (contextmenu)="canUnlockDocumentManually?onRightClick($event,row):null"
          [axTooltip]="row.lockedBy"
          [axTooltipStyle]="'primary'"
          [axTooltipPosition]="'above'"
          [axTooltipPointerPosition]="'center'"
          >lock</mat-icon
        >
      </ng-template>
    </td>
  </ng-container>
</ax-table>
