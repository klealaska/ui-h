<xdc-escalation-reason
  *ngIf="(activityToDisplay$ | async)"
  [activity]="activityToDisplay$ | async"
></xdc-escalation-reason>

<div class="fields-wrapper">
  <xdc-dropdown-field
    class="fields-dynamic-child-full dropdown-margin"
    *ngIf="formGroupInstance$ | async as formGroupInstance"
    [fieldTitle]="'Invoice Type'"
    [choices]="invoiceTypeOptions"
    [placeholder]="'Select Invoice Type'"
    [selectedValue]="invoiceType$ | async"
    [confidence]="invoiceTypeConfidence"
    [confidenceThreshold]="invoiceTypeConfidenceThreshold$ | async"
    [editMode]="true"
    [width]="100"
    (dropdownChanged)="handleInvoiceTypeSelect($event)"
  ></xdc-dropdown-field>

  <ng-template [ngIf]="(lookupFormFields$ | async).length > 0">
    <xdc-lookup-fields
      class="fields-dynamic-child-full"
      tabindex="0"
      *ngFor="let field of lookupFormFields$ | async"
      [field]="field"
      [formGroupInstance]="formGroupInstance$ | async"
      [customerAccounts]="customerAccounts$ | async"
      [properties]="properties$ | async"
      [suppliers]="suppliers$ | async"
      [isLookupLoading]="isLookupLoading$ | async"
      [isDefaultShipToLoading]="isDefaultShipToLoading$ | async"
      [confidence]="getConfidencePercentage(field)"
      [confidenceColor]="setConfidenceColor(field)"
      [lastLabelUpdated]="lastLabelUpdated$ | async"
      [latestFieldAssociation]="latestFieldAssociation$ | async"
      [highlightLabels]="highlightLabels"
      [editModeField]="editModeField"
      [canCreateAccount]="canCreateAccount"
      [customerAccountFieldValue]="customerAccountFieldValue$ | async"
      [supplierFieldValue]="selectedSupplier$ | async"
      [shipToFieldValue]="selectedProperty$ | async"
      [tabbedToField]="tabbedToField"
      [selectedDocumentText]="selectedDocumentText$ | async"
      [lookupLoadingState]="lookupLoadingState$ | async"
      [isSponsorUser]="canViewAllBuyers$ | async"
      [canEditPredictedValues]="canEditPredictedValues$ | async"
      [supplierPredictionIsActive]="supplierPredictionIsActive$ | async"
      (keyup.Tab)="tabKeyPressLookup(field)"
      (formChanged)="updateOnManualIntervention($event)"
      (searchText)="queryLookupField($event)"
      (updateLookupValue)="updateLookupValue($event)"
      (removeLatestFieldAssociation)="removeLatestFieldAssociation()"
      (resetLookupDropdownData)="resetLookupDropdownData()"
      (openAccountNumberModal)="openCreateAccountModal($event)"
      (labelHoverEvent)="getBoundingBoxId($event)"
      (resetLookUpFieldsEditMode)="resetLookUpFieldsEditMode($event)"
      (fieldSelectedForAssociation)="lookupFieldSelectedForAssociation($event)"
      (handleNoSelection)="handleNoSelection($event)"
    ></xdc-lookup-fields>
  </ng-template>

  <ng-template [ngIf]="(nonLookupFormFields$ | async).length > 0">
    <xdc-non-lookup-field
      class="fields-dynamic-child"
      tabindex="0"
      *ngFor="let field of nonLookupFormFields$ | async"
      [field]="field"
      [formGroupInstance]="formGroupInstance$ | async"
      [confidence]="getConfidencePercentage(field)"
      [confidenceColor]="setConfidenceColor(field)"
      [highlightLabels]="highlightLabels"
      [associatedErrorMessage]="associatedErrorMessage$ | async"
      [nonLookupErrorMessage]="nonLookupErrorMessage$ | async"
      [tabbedToField]="tabbedToField"
      [selectedDocumentText]="selectedDocumentText$ | async"
      [isSponsorUser]="canViewAllBuyers$ | async"
      [canEditPredictedValues]="canEditPredictedValues$ | async"
      [canDisplayPredictedValues]="canDisplayPredictedValues"
      [multipleDisplayThresholdsIsActive]="multipleDisplayThresholdsIsActive$ | async"
      (keyup.Tab)="tabKeyPress(field)"
      (valueChanged)="updateNonLookupField($event)"
      (labelHoverEvent)="getBoundingBoxId($event)"
      (fieldSelectedForAssociation)="fieldSelectedForAssociation($event)"
    ></xdc-non-lookup-field>
  </ng-template>

  <ng-template [ngIf]="(lookupFormFieldsBottom$ | async).length > 0">
    <xdc-lookup-fields
      class="fields-dynamic-child"
      tabindex="0"
      *ngFor="let field of lookupFormFieldsBottom$ | async"
      [field]="field"
      [orderedBy]="orderedBy$ | async"
      [orderedByFieldValue]="selectedOrderedBy$ | async"
      [workflow]="workflow$ | async"
      [workflowFieldValue]="selectedWorkflow$ | async"
      [formGroupInstance]="formGroupInstance$ | async"
      [isLookupLoading]="isLookupLoading$ | async"
      [confidence]="getConfidencePercentage(field)"
      [confidenceColor]="setConfidenceColor(field)"
      [lastLabelUpdated]="lastLabelUpdated$ | async"
      [latestFieldAssociation]="latestFieldAssociation$ | async"
      [highlightLabels]="highlightLabels"
      [editModeField]="editModeField"
      [canCreateAccount]="canCreateAccount"
      [tabbedToField]="tabbedToField"
      [selectedDocumentText]="selectedDocumentText$ | async"
      [isSponsorUser]="canViewAllBuyers$ | async"
      [canEditPredictedValues]="canEditPredictedValues$ | async"
      [multipleDisplayThresholdsIsActive]="multipleDisplayThresholdsIsActive$ | async"
      [lookupLoadingState]="lookupLoadingState$ | async"
      (keyup.Tab)="tabKeyPress(field)"
      (formChanged)="updateOnManualIntervention($event)"
      (searchText)="queryLookupField($event)"
      (updateLookupValue)="updateLookupValue($event)"
      (removeLatestFieldAssociation)="removeLatestFieldAssociation()"
      (resetLookupDropdownData)="resetLookupDropdownData()"
      (labelHoverEvent)="getBoundingBoxId($event)"
      (resetLookUpFieldsEditMode)="resetLookUpFieldsEditMode($event)"
      (fieldSelectedForAssociation)="lookupFieldSelectedForAssociation($event)"
      (handleNoSelection)="handleNoSelection($event)"
    ></xdc-lookup-fields>
  </ng-template>

  <ng-template [ngIf]="(nonLookupFormFieldsBottom$ | async).length > 0">
    <xdc-non-lookup-field
      class="fields-dynamic-child"
      tabindex="0"
      *ngFor="let field of nonLookupFormFieldsBottom$ | async"
      [field]="field"
      [formGroupInstance]="formGroupInstance$ | async"
      [confidence]="getConfidencePercentage(field)"
      [confidenceColor]="setConfidenceColor(field)"
      [highlightLabels]="highlightLabels"
      [associatedErrorMessage]="associatedErrorMessage$ | async"
      [nonLookupErrorMessage]="nonLookupErrorMessage$ | async"
      [tabbedToField]="tabbedToField"
      [selectedDocumentText]="selectedDocumentText$ | async"
      (keyup.Tab)="tabKeyPress(field)"
      (valueChanged)="updateNonLookupField($event)"
      (labelHoverEvent)="getBoundingBoxId($event)"
      (fieldSelectedForAssociation)="fieldSelectedForAssociation($event)"
      [isSponsorUser]="canViewAllBuyers$ | async"
      [canEditPredictedValues]="canEditPredictedValues$ | async"
      [canDisplayPredictedValues]="canDisplayPredictedValues"
    ></xdc-non-lookup-field>
  </ng-template>
</div>
