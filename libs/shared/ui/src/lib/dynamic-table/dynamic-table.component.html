<div *ngIf="filtering">
  <div *ngIf="serverSortingFiltering">
    <mat-form-field appearance="outline">
      <mat-label>Filter</mat-label>
      <input
        matInput
        data-test="table-filtering"
        [formControl]="filter"
        placeholder="Search table"
        #input
      />
    </mat-form-field>
  </div>
  <div *ngIf="!serverSortingFiltering">
    <mat-form-field appearance="outline">
      <mat-label>Filter</mat-label>
      <input
        matInput
        data-test="table-filtering"
        (keyup)="applyFilter($event)"
        placeholder="Ex. ium"
        #input
      />
    </mat-form-field>
  </div>
</div>

<div class="desktop-table">
  <table
    mat-table
    [dataSource]="dataSource"
    matSort
    multiTemplateDataRows
    [matSortActive]="defaultSort?.column"
    [matSortDirection]="defaultSort?.direction"
  >
    <ng-container
      *ngFor="let column of columnDefs"
      [matColumnDef]="column.columnDef"
      [ngSwitch]="column.columnDef"
    >
      <ng-container *ngSwitchCase="'singleSelect'">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let row">
          <mat-radio-button
            color="primary"
            (change)="$event ? changeRadioButton(row) : null"
            [class]="selectionType.isSelected(row) ? 'mat-radio-checked' : ''"
            (click)="buttonEvent.emit(row)"
          ></mat-radio-button>
        </td>
      </ng-container>

      <ng-container *ngSwitchCase="'multiSelect'">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            color="primary"
            (change)="$event ? masterToggle() : null"
            [checked]="selectionType.hasValue() && isAllSelected()"
            [indeterminate]="selectionType.hasValue() && !isAllSelected()"
          ></mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox
            color="primary"
            (click)="clickCheckbox($event)"
            (change)="$event ? checkboxToggle(row) : null"
            [checked]="selectionType.isSelected(row)"
          ></mat-checkbox>
        </td>
      </ng-container>

      <ng-container *ngSwitchCase="'action'">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let row" class="expandable-icon">
          <mat-icon *ngIf="row?.isExpandable" (click)="row.isExpanded = !row?.isExpanded">
            {{row?.isExpanded ? 'expand_less' : 'expand_more'}}
          </mat-icon>
        </td>
      </ng-container>

      <ng-container *ngSwitchDefault>
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ column.headerCellDef }}</th>
        <td mat-cell *matCellDef="let data">
          <ax-dynamic-table-cell [columnDef]="column" [data]="data"> </ax-dynamic-table-cell>
        </td>
      </ng-container>
    </ng-container>

    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let data" [attr.colspan]="columnDefs.length" class="expanded-row">
        <div
          class="expanded-data-detail"
          [@detailExpand]="data?.isExpanded ? 'expanded' : 'collapsed'"
        >
          <ax-dynamic-expandable-cell [data]="data"></ax-dynamic-expandable-cell>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      [class.expanded-detail-row]="row?.isExpanded"
      [ngClass]="(selectionType.isSelected(row))?'row-checked':''"
      class="table-row"
    ></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: ['expandedDetail']"
      class="expanded-detail-row expanded-detail"
    ></tr>
  </table>
</div>

<ax-mobile-table
  class="mobile-table"
  [dataSource]="mobileData"
  [columnDefs]="columnDefs"
  [selectionType]="selectionType"
  (checkboxEvent)="clickCheckbox($event)"
  (buttonEvent)="buttonEvent.emit($event)"
  (checkboxToggle)="checkboxToggle($event)"
  (changeRadioButton)="changeRadioButton($event)"
></ax-mobile-table>

<mat-paginator
  *ngIf="paginator"
  aria-label="Select page of users"
  [pageSize]="paginator.pageSize"
  [pageSizeOptions]="paginator.pageSizeOptions"
  [disabled]="paginator.disabled"
  [hidePageSize]="paginator.hidePageSize"
  [pageIndex]="paginator.pageIndex"
  [showFirstLastButtons]="paginator.showFirstLastButtons"
  (page)="paginatorEvent.emit($event)"
></mat-paginator>
