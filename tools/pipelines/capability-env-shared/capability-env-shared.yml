#####################################
# Use app specific variables template
#####################################
variables:
  - template: './variables/common.yml'

#####################################
#      DO NOT EDIT BELOW HERE       #
#####################################
# Location to reference a container, where the stages will be run
resources:
  containers:
    - container: cicd_devtools
      image: axglbhubacr.azurecr.io/cicd-devtools:latest
      endpoint: DefaultDockerRegistry
      options: '--user root'

pool:
  name: linux-vmss-agent-pool

# Calling the env-stage-template.yml file, and passing it variables established above, for each individual environment
stages:
  - template: '../templates/env-stage-template.yml'
    parameters:
      capability: $(capability)
      domain: $(domain)
      tfDirectory: $(System.DefaultWorkingDirectory)/tools/iac/capability-env-shared #TODO Change to Current Apps Path
      stages:
        - stage:
          name: Dv
          dependsOn: ''
          varFile: '../../iac/capability-env-shared/variables/east/vars-dv.tfvars'
          serviceConnection: $(nonProdServiceConnection)
          subscriptionId: $(nonProdSubscriptionId)
        - stage:
          name: DvWest
          dependsOn: ''
          varFile: '../../iac/capability-env-shared/variables/west/vars-dv.tfvars'
          serviceConnection: $(nonProdServiceConnection)
          subscriptionId: $(nonProdSubscriptionId)
        - stage:
          name: Ci
          dependsOn: 'Dv'
          varFile: '../../iac/capability-env-shared/variables/east/vars-ci.tfvars'
          serviceConnection: $(nonProdServiceConnection)
          subscriptionId: $(nonProdSubscriptionId)
        - stage:
          name: CiWest
          dependsOn: 'DvWest'
          varFile: '../../iac/capability-env-shared/variables/west/vars-ci.tfvars'
          serviceConnection: $(nonProdServiceConnection)
          subscriptionId: $(nonProdSubscriptionId)
        - stage:
          name: Qa
          dependsOn: 'Ci'
          varFile: '../../iac/capability-env-shared/variables/east/vars-qa.tfvars'
          serviceConnection: $(nonProdServiceConnection)
          subscriptionId: $(nonProdSubscriptionId)
        - stage:
          name: QaWest
          dependsOn: 'CiWest'
          varFile: '../../iac/capability-env-shared/variables/west/vars-qa.tfvars'
          serviceConnection: $(nonProdServiceConnection)
          subscriptionId: $(nonProdSubscriptionId)
        - stage:
          name: St
          dependsOn: 'Qa'
          varFile: '../../iac/capability-env-shared/variables/east/vars-st.tfvars'
          serviceConnection: $(prodServiceConnection)
          subscriptionId: $(prodSubscriptionId)
        - stage:
          name: StWest
          dependsOn: 'QaWest'
          varFile: '../../iac/capability-env-shared/variables/west/vars-st.tfvars'
          serviceConnection: $(prodServiceConnection)
          subscriptionId: $(prodSubscriptionId)
        - stage:
          name: Pr
          dependsOn: 'St'
          varFile: '../../iac/capability-env-shared/variables/east/vars-pr.tfvars'
          serviceConnection: $(prodServiceConnection)
          subscriptionId: $(prodSubscriptionId)
        - stage:
          name: PrWest
          dependsOn: 'StWest'
          varFile: '../../iac/capability-env-shared/variables/west/vars-pr.tfvars'
          serviceConnection: $(prodServiceConnection)
          subscriptionId: $(prodSubscriptionId)
